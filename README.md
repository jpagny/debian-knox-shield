# Debian knox shield

![Debian Knox Shield Logo](debian-knox-shield-logo.png)


## Description

**Secure your Debian server with ease**

Debian knox shield is a robust and modular tool designed to enhance the security of your Debian server. This build script empowers users to secure their server environments effectively, integrating a suite of customizable scripts and security measures. With Debian Knox Shield, fortify your server against vulnerabilities and tailor the security to your specific needs.

## Context

I developed Debian Knox Shield after subscribing to a VPS server and realizing the scarcity of repositories offering post-installation Debian security scripts that were either not very modular or didn't meet my specific needs. This project is a personal journey into enhancing server security while learning and evolving in the field.

## Project Structure

| Folder    | Under folder      | Description |
| --------- | ----------------- | ----------- |
| `config/` |                   | Contains default configuration files with tasks organized in the proper procedural order. |
| `core/`   |                   | The core of the project. Modify only if you are certain of the changes. |
| `output/` |                   | Contains the output script post-build, which should be executed on your server. |
| `task/`   |                   | Holds all the scripts. Users can choose which to use, and add their own scripts to the configuration. |
|           | `firewall/`       | Contains all tasks related to firewall management.  |
|           | `network/`        | Contains all tasks related to network management and configuration. |
|           | `scheduler/`      | Contains all tasks related to task scheduling and event management.|
|           | `system/`         | Contains all tasks related to overall system management and configuration. |
|           | `tool/`           | Contains all tools and utilities supporting script development and execution. |
|           | `tool_secure/`    | Contains all tools and utilities specifically designed for enhancing server security. |
|           | `user/`           | Contains all tasks and scripts related to user account management and permissions. |
| `tool/`   |                   | Tools to assist in rapid script development. |

## Installation

1. Clone the repository: `git clone https://github.com/jpagny/debian-knox-shield.git`
2. Make the build script executable: `chmod +x build.sh`
3. Execute the build script: `./build.sh`


## How It Works

### 1. Creating a Task

To create a task, run the following command from the root of the project: 

```shell
tool/build_task.sh "task_name" "folder_name" "need_prerequisites" "need_post_action"
```

**For example:**

```shell
`tool/build_task.sh "hello_world" "message" true true`
```

This command will create a task in `task/message/hello_world.sh` with a ready-made template that includes prerequisite functions and post-action steps.


```shell
#!/bin/bash

# import
# shellcheck source=/dev/null
source "$(dirname "$0")/../core/00_variable_global.sh"
source "$(dirname "$0")/../core/01_logger.sh"
source "$(dirname "$0")/../core/02_execute_task.sh"
source "$(dirname "$0")/../core/03_utils.sh"

task_hello_world() {
  
  local name="hello_world"
  local isRootRequired=true
  local prereq="check_prerequisites_$name"
  local actions="run_action_$name"
  local postActions="post_actions_$name"
  local task_type=""

  if ! execute_and_check "$name" $isRootRequired "$prereq" "$actions" "$postActions" "$task_type"; then
    log_error "hello_world failed."
    return "$NOK"
  fi

  log_info "hello_world has been successfully hello_worldx."
  
  return "$OK"
}

check_prerequisites_hello_world() {
    # add your prerequisites here
    return "$OK"
}

run_action_hello_world() {
    # add your action here
    echo "hello world !"
    return "$OK"
}

post_actions_hello_world() {
    # add your post action here
    return "$OK"
}

# Run the task to hello_world
task_hello_world
```

The script generated by the `tool/build_task.sh` command will include or exclude certain functions based on the options you specify. 

For instance, if `need_prerequisites` and `need_post_action` are set to `false`, the functions `check_prerequisites_hello_world` and `post_actions_hello_world` will not be included in the script.


### 2. Adding the New Task to the Configuration

After creating a new task, you need to add it to the configuration file. This can be done either in the default configuration file or in a custom configuration file.

- **Default Configuration**: To add the task to the default configuration, simply insert the task's details into the `default_config.txt` file located in the `config/` directory.

- **Custom Configuration**: If you are using a custom configuration file, add the task's details to your custom file. Ensure that this custom configuration file is correctly referenced when executing your scripts.

</br>

**For example with hello_world task:**

To add the `hello_world` task under the `message` category, you would enter the following line in your configuration file:

```
#Manage message
optional|message/hello_world.sh
```

There are two types of tasks you can specify in the configuration:

- **mandatory**: If this task fails, the entire script execution will stop immediately. Format: `mandatory|path/to/task.sh`
  
- **optional**: If this task fails, the script will continue and proceed to the next task. Format: `optional|path/to/task.sh`

Be sure to follow the correct format and order in the configuration file for the tasks to be recognized and executed correctly.

### 3. Launching the Build

Once you have added your new task to the configuration file, the next step is to launch the build script. This script will compile all the tasks and the core into a single executable script.

- **Using the Default Configuration**: If you are using the default configuration, simply run the command:

```
./build
```

- **Using a Custom Configuration**: 
If you have a custom configuration, specify the name of your configuration file with the `--config` option when running the build command:

```
./build --config <custom_config_file.txt>
```

Replace `<custom_config_file>` with the name of your custom configuration file.

- **Changing the Output Location**:
To change the output location, use the `--output` option:

```
./build --output <output_directory>
```
Replace `<output_directory>` with your desired output location.

These commands will use your specified settings to create the final script.

- **Combining Options**:
Of course, you can also combine both the `--config` and `--output` options:

```
./build --config <custom_config_file> --output <output_directory>
```

This allows you to use a custom configuration and specify a different output location simultaneously.

These commands will use your specified settings to create the final script.


### 4. Retrieving and Preparing the Output Script

After the build process is complete, the next step is to transfer the output script to your server and prepare it for execution.

- **Transfer the Script**: 
  Copy the generated script from the output directory to your server. This can be done via secure copy (SCP), FTP, or any other file transfer method you prefer.

- **Make the Script Executable**: 
  Once the script is on your server, you need to make it executable. Run the following command:

```
chmod +x /path/to/script.sh
```

Replace `/path/to/script.sh` with the actual path to your script.

- **Reformatting for Linux (if generated on Windows)**:
If you generated the script on a Windows system, it's advisable to reformat it for Linux compatibility. Use the `dos2unix` utility:

```
dos2unix /path/to/script.sh
```

- **Execute the Script**:
Finally, execute the script with root privileges:

```
sudo /path/to/script.sh
```
Ensure you have the necessary permissions on the server to execute scripts and make these changes.

</br>

---

**⚠️ Caution:**
**be very careful when executing the script. Ensure you have noted down all necessary credentials before restarting or exiting the server. Failure to do so may result in losing access to the server, potentially requiring a complete reformat.**

---

</br>

## List of Tasks

Below is a table of tasks included in the Debian Knox Shield project:

| Folder      | Task Name      | Purpose of Task                                 |
|-------------|----------------|-------------------------------------------------|
| `folder1/`  | `task1.sh`     | Description of what task1 does.                 |
| `folder2/`  | `task2.sh`     | Description of what task2 does.                 |
| `folder3/`  | `task3.sh`     | Description of what task3 does.                 |



## Contributing

We welcome contributions to Debian Knox Shield! If you're interested in helping out, please follow these steps:

1. **Fork the Repository**: Create your own fork of the repository by clicking the "Fork" button on the GitHub page. This creates a copy of the project in your own GitHub account.

2. **Clone Your Fork**: Clone your fork to your local machine (use `git clone https://github.com/your-username/debian-knox-shield.git`, replacing `your-username` with your GitHub username).

3. **Create a New Branch**: Before making your changes, switch to a new branch in your local repository (e.g., `git checkout -b my-new-feature`).

4. **Make Your Changes**: Implement the changes you want to make in your branch.

5. **Commit Your Changes**: Commit your changes with descriptive commit messages (use `git commit -m "A brief description of the change"`).

6. **Push to Your Fork**: Push your changes to your fork on GitHub (`git push origin my-new-feature`).

7. **Submit a Pull Request**: Go to the original repository on GitHub, and you'll see a prompt to submit a pull request from your new branch. Click the "Compare & pull request" button and submit it with a clear description of your changes.

Please ensure your code adheres to the existing style of the project to make the review process faster.

Thank you for your contributions!


## Credits

A special thanks to:

- [Marek Beckmann](https://github.com/marekbeckmann/Secure-Debian-Script) for the Secure Debian Script.
- [imthenachoman](https://github.com/imthenachoman/How-To-Secure-A-Linux-Server#why-secure-your-server) for their comprehensive guide on securing a Linux server.
- ChatGPT for assistance in developing and documenting this project.

Their contributions and resources have been invaluable in the creation of Debian Knox Shield.


## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE.txt) file for details.
